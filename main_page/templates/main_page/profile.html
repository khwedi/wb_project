{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Профиль</title>
    <link rel="stylesheet" href="{% static 'main_page/main_page.css' %}">
    <link rel="stylesheet" href="{% static 'main_page/profile.css' %}">
    <link rel="stylesheet" href="{% static 'start_page/email_code.css' %}">
</head>
<body>

<div class="page-layout">
    <main class="profile-details">
        <h1>Профиль</h1>

        <!-- Имя пользователя -->
        <div class="profile-row">
            <div class="profile-label">Имя пользователя</div>
            <div class="profile-value">
                <span id="username-display">{{ request.user.username }}</span>
                <input
                    type="text"
                    id="username-input"
                    class="profile-input"
                    value="{{ request.user.username }}"
                    style="display: none;"
                >
                <div id="username-error" class="profile-error"></div>
            </div>
            <div class="profile-actions">
                <button type="button" class="btn" id="username-edit-btn">Изменить</button>
                <button type="button" class="btn" id="username-save-btn" style="display: none;">Сохранить</button>
                <button type="button" class="btn" id="username-cancel-btn" style="display: none;">Отмена</button>
            </div>
        </div>

        <!-- Почта -->
        <div class="profile-row">
            <div class="profile-label">Почта</div>
            <div class="profile-value">
                <span id="email-masked">{{ masked_email }}</span>
                <span id="email-full" style="display: none;">{{ full_email }}</span>

                <!-- Индикатор успешной смены email -->
                <div id="email-change-success" class="profile-success"></div>
            </div>
            <div class="profile-actions">
                <button type="button" class="btn" id="email-toggle-btn">Показать</button>
                <button type="button" class="btn" id="profile-email-change-btn">Изменить</button>
            </div>
        </div>


        <!-- Пароль -->
        <div class="profile-row">
            <div class="profile-label">Пароль</div>
            <div class="profile-value">
                <span id="password-placeholder">********</span>

                <div id="password-edit-block" class="password-edit-block" style="display: none;">
                    <input
                        type="password"
                        id="current-password-input"
                        class="profile-input"
                        placeholder="Текущий пароль"
                    >
                    <input
                        type="password"
                        id="new-password1-input"
                        class="profile-input"
                        placeholder="Новый пароль"
                    >
                    <input
                        type="password"
                        id="new-password2-input"
                        class="profile-input"
                        placeholder="Повторите новый пароль"
                    >
                    <div id="password-change-error" class="profile-error"></div>
                </div>

                <!-- Индикатор успешной смены пароля -->
                <div id="password-change-success" class="profile-success"></div>
            </div>
            <div class="profile-actions">
                <button type="button" class="btn" id="password-edit-btn">Изменить</button>
                <button type="button" class="btn" id="password-save-btn" style="display: none;">Сохранить</button>
                <button type="button" class="btn" id="password-cancel-btn" style="display: none;">Отмена</button>
            </div>
        </div>

        <!-- Назад на главную -->
        <div class="profile-row">
            <div class="profile-label"></div>
            <div class="profile-value">
                <a href="{% url 'main_page:main_page' %}" class="btn">Назад на главную</a>
            </div>
            <div class="profile-actions"></div>
        </div>

    </main>
</div>

<!-- csrf для AJAX -->
<input type="hidden" id="csrf-token" value="{{ csrf_token }}">

{% include "start_page/email_code_modals.html" %}

<script src="{% static 'main_page/profile.js' %}"></script>
<script>
    window.EC_CONFIG = {
        mode: "change_email",
        triggerId: "profile-email-change-btn"
    };
</script>
<script src="{% static 'start_page/email_code.js' %}"></script>
</body>
</html>
